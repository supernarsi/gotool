package compose_test

import (
	"testing"

	"github.com/supernarsi/gotool/geo/compose"
)

func TestDouglasPeucker(t *testing.T) {
	tests := []struct {
		name  string
		input []compose.Point
		want  []compose.Point
	}{
		{name: "test1", input: []compose.Point{{0, 0}, {1, 1}, {2, 2}, {3, 3}}, want: []compose.Point{{0, 0}, {3, 3}}},
		{
			name: "test2",
			input: []compose.Point{
				{29.600307850964363, 106.50623532346269},
				{29.600331225981076, 106.50615617160405},
				{29.608226, 106.50092},
				{29.608253, 106.500941},
				{29.60821, 106.500963},
				{29.608221, 106.500984},
			},
			want: []compose.Point{{29.600307850964363, 106.50623532346269}, {29.608221, 106.500984}},
		},
		{
			name: "test3",
			input: []compose.Point{
				{29.600307850964363, 106.50623532346269},
				{29.600331225981076, 106.50615617160405},
				{29.600376790384363, 106.50606931408845},
				{29.600421269416213, 106.50600073184677},
				{29.60048230817131, 106.50593376572789},
				{29.600783516101032, 106.5049902577372},
				{29.601142624261637, 106.504310853574},
				{29.601173925902685, 106.50425017717171},
				{29.601196135239515, 106.50420601078312},
				{29.601217723538145, 106.50414555317982},
				{29.60125011692011, 106.50407776815615},
				{29.601264900751662, 106.5040115374751},
				{29.60129771406872, 106.50394381230736},
				{29.601295332535148, 106.5038545795922},
				{29.601285457772367, 106.50378562568156},
				{29.60128441620573, 106.50372968328345},
				{29.60126616837989, 106.50366097815721},
				{29.60139287179201, 106.50230189910724},
				{29.601467274493455, 106.5023044955755},
				{29.60153162685326, 106.50231623406722},
				{29.60160257705776, 106.50231933881467},
				{29.601661384592404, 106.50231558343097},
				{29.60171759157669, 106.50230513795164},
				{29.60177236806361, 106.50230799252492},
				{29.601830434700627, 106.50230114636322},
				{29.60187792048587, 106.50229693170931},
				{29.601924133985502, 106.50231657546928},
				{29.6019576667084, 106.50231210079757},
				{29.602011747837608, 106.5023100300942},
				{29.60208274181027, 106.50230855856115},
				{29.60215864325679, 106.50228515305369},
				{29.602221205420562, 106.50228019149996},
				{29.602286461616437, 106.50227745343545},
				{29.60235026669692, 106.50227163452261},
				{29.60242170750834, 106.50229446018645},
				{29.60248864162448, 106.50230250988236},
				{29.60255219723208, 106.50229317150465},
				{29.602593222124604, 106.5022820172825},
				{29.602653939632052, 106.50228837170471},
				{29.602727467068892, 106.50227601295008},
				{29.60277536105935, 106.50225914624306},
				{29.602846777076458, 106.50226364683333},
				{29.602915864785892, 106.50229059002054},
				{29.602974616579914, 106.50228206891872},
				{29.603039548080044, 106.5023140068965},
				{29.603110412069285, 106.50232575572873},
				{29.603173549469037, 106.50233566961958},
				{29.6032256014258, 106.50230657978891},
				{29.603265720266556, 106.50231724012725},
				{29.60332122177841, 106.50230850946804},
				{29.60337527434301, 106.50229598011241},
				{29.603443536426447, 106.5022550467079},
				{29.603506857635885, 106.50223385384982},
				{29.603576859075783, 106.50224304031376},
				{29.60364572117968, 106.50224526757226},
				{29.603694596228266, 106.50224802210829},
				{29.60776295117472, 106.5018521013031},
				{29.607824762823174, 106.50183714964957},
				{29.60783254123113, 106.50176206513875},
				{29.607803067026328, 106.50170443617702},
				{29.60775461045737, 106.50166248912706},
				{29.607734161039208, 106.50160075298415},
				{29.6077412708345, 106.50152181994986},
				{29.60772873254477, 106.50145045311042},
				{29.607977402285677, 106.50085201049276},
				{29.6081231863431, 106.50077067250217},
			},
			want: []compose.Point{
				{29.600307850964363, 106.50623532346269},
				{29.60129771406872, 106.50394381230736},
				{29.60139287179201, 106.50230189910724},
				{29.603173549469037, 106.50233566961958},
				{29.60776295117472, 106.5018521013031},
				{29.60772873254477, 106.50145045311042},
				{29.6081231863431, 106.50077067250217},
			},
		},
		{
			name: "test4",
			input: []compose.Point{
				{29.608116104756302, 106.4997607863001},
				{29.607963587694986, 106.49945703664568},
				{29.60807456889446, 106.49882461474678},
				{29.60784939954644, 106.4985280783707},
				{29.607292940342774, 106.49669434954343},
				{29.60706928820842, 106.49648123164401},
				{29.606587326935006, 106.49619763846829},
				{29.603506123714475, 106.49612959443915},
				{29.603195289501308, 106.49638001113176},
				{29.603221290019118, 106.49664613992702},
				{29.603926298014162, 106.49661765518223},
				{29.603621719383014, 106.49682985540285},
				{29.603462564618557, 106.49673344361297},
			},
			want: []compose.Point{
				{29.608116104756302, 106.4997607863001},
				{29.607963587694986, 106.49945703664568},
				{29.60807456889446, 106.49882461474678},
				{29.60784939954644, 106.4985280783707},
				{29.607292940342774, 106.49669434954343},
				{29.60706928820842, 106.49648123164401},
				{29.606587326935006, 106.49619763846829},
				{29.603506123714475, 106.49612959443915},
				{29.603195289501308, 106.49638001113176},
				{29.603221290019118, 106.49664613992702},
				{29.603926298014162, 106.49661765518223},
				{29.603621719383014, 106.49682985540285},
				{29.603462564618557, 106.49673344361297},
			},
		},
		{
			name: "test5",
			input: []compose.Point{
				{29.608118282540726, 106.49987470541308}, {29.60810514699801, 106.49982553186496},
				{29.608082511243634, 106.49976560993976}, {29.60806589908812, 106.49970170028438},
				{29.608047895128543, 106.49964490923169}, {29.608031813060506, 106.49964084048912},
				{29.608034680565787, 106.49963527730337}, {29.608031822590057, 106.49963434991545},
				{29.60802868429929, 106.49963350227283}, {29.60802986817412, 106.4996289958279},
				{29.608029758774723, 106.4996287864483}, {29.608029849668917, 106.49962849731882},
				{29.608029951645904, 106.49962784926423}, {29.608028550989214, 106.49962461885235},
				{29.608026738644217, 106.49962523689892}, {29.608026519545383, 106.49962491784129},
				{29.60802792497915, 106.49961991290085}, {29.608020472690413, 106.49959674182165},
				{29.608014953251292, 106.49957944327643}, {29.608009362491675, 106.49957587363956},
				{29.608008922613816, 106.49957579385317}, {29.60798114772725, 106.4994386426911},
				{29.608088147798984, 106.49917215610348}, {29.608084659626282, 106.49888183422395},
				{29.607872055576774, 106.49871448244332}, {29.607606994743495, 106.49878759866662},
				{29.607357864485262, 106.49891847306418}, {29.607097596199505, 106.49901438134185},
				{29.606828931041846, 106.49902197326098}, {29.60656197603939, 106.49902298495834},
				{29.606289907506067, 106.49900472400371}, {29.606009402212305, 106.49902118870904},
				{29.605734121954956, 106.49902643725845}, {29.605481573470676, 106.49901648257868},
				{29.605346089826444, 106.49903208815228}, {29.605325325724714, 106.49904155863922},
				{29.605325531753262, 106.49904622469542}, {29.60532843480991, 106.49903881701697},
				{29.605292730717498, 106.49903363048593}, {29.605106983780107, 106.49908902417768},
				{29.60501952665785, 106.49931296925907}, {29.605016628194036, 106.49961473611813},
				{29.60500831390171, 106.49992448848336}, {29.604998174818448, 106.50020566604547},
				{29.60497985271252, 106.50032096971539}, {29.60497216161523, 106.50032064026213},
				{29.604970916380154, 106.5003189452669}, {29.60497827187957, 106.5003343894369},
				{29.604975801891314, 106.50032751986801}, {29.604979274510864, 106.50032364168061},
				{29.60498027526281, 106.50032348221539}, {29.60498067477091, 106.50032368164102},
				{29.604981083771285, 106.50032405055961}, {29.60498095322555, 106.50032422004459},
				{29.605001533821067, 106.50046204844564}, {29.605008228169876, 106.500763376251},
				{29.60501421129885, 106.50107824327272}, {29.605001887980055, 106.50138356768112},
				{29.60500204224101, 106.50165757653038}, {29.605004274404592, 106.50182958114551},
				{29.60499331059053, 106.50207202385276}, {29.604997265395806, 106.5023825732218},
				{29.604998903289758, 106.50269516629535}, {29.604983612001146, 106.50301256399194},
				{29.604979192144633, 106.50332381076967}, {29.605002540340685, 106.50358513880397},
				{29.604981513115668, 106.50386084127696}, {29.604981030129913, 106.50416351418063},
				{29.604986248277484, 106.5044630170307}, {29.604964387841033, 106.50472646648787},
				{29.604807124943463, 106.50486248006679}, {29.604570782329432, 106.50486192823294},
				{29.604314232552163, 106.50484532333296}, {29.60405673842112, 106.50482673432292},
				{29.60380955761942, 106.50480131635857}, {29.603568401150095, 106.5048015120106},
				{29.603360071265172, 106.50481242742421}, {29.603398564473284, 106.50492760461442},
				{29.603423931964976, 106.50491415634407}, {29.603430452616422, 106.50491121552494},
				{29.603435130004804, 106.50491582199386}, {29.6034263885127, 106.50492547258824},
				{29.603425118616574, 106.50492532296396}, {29.603425259256316, 106.50492512356924},
				{29.60342493931919, 106.50492507370035}, {29.60342465843066, 106.50492534287804},
				{29.603425040158506, 106.50492480451241}, {29.603425141358695, 106.50492441568285},
				{29.603425106640632, 106.50492266093693}, {29.60342652074358, 106.50492474477582},
				{29.603421004094617, 106.50492644935525}, {29.603421485849797, 106.50492591099531},
				{29.603421766497743, 106.50492572157869}, {29.603421746732856, 106.50492564181648},
				{29.603421907949457, 106.50492525299033}, {29.603421918313064, 106.50492513334929},
				{29.60342214903756, 106.50492491401941}, {29.603422399647226, 106.50492473457123},
				{29.603422489972566, 106.50492463487501}, {29.60342260039359, 106.50492450526951},
				{29.60342287133953, 106.504924216151}, {29.603422921413348, 106.50492419621357},
				{29.603423101612925, 106.50492414637313}, {29.603423111314928, 106.50492424607505},
				{29.603423201730486, 106.50492411646842}, {29.603423111946466, 106.50492403670223},
				{29.603423091940996, 106.5049240367011}, {29.603423062023015, 106.50492400678897},
				{29.603423001976534, 106.5049240167557}, {29.603423212485048, 106.50492386721562},
				{29.603423352793982, 106.50492377749238}, {29.603423372619012, 106.50492383731434},
				{29.60342763688809, 106.50492944077348}, {29.60344759462773, 106.50492868417855},
				{29.603452072599858, 106.5049397114041}, {29.603450912338296, 106.50494964159412},
				{29.60345137201295, 106.50494979117232}, {29.603451192294546, 106.5049496814906},
				{29.6034512128714, 106.50494949205915}, {29.603451563237734, 106.50494940234786},
				{29.60345201369155, 106.504949292702}, {29.60345209422466, 106.50494912321425},
				{29.603452014353156, 106.50494907335903}, {29.60345214420826, 106.50494913318724},
				{29.60345239478784, 106.50494896370917}, {29.603452395479515, 106.50494873439607},
				{29.603452296113783, 106.5049485150474}, {29.603452186955828, 106.50494822590723},
				{29.603452137303034, 106.50494810626276}, {29.60345228734404, 106.5049481062713},
				{29.60345259790995, 106.50494794676679}, {29.603452608664508, 106.50494769751398},
			},
			want: []compose.Point{
				{29.608118282540726, 106.49987470541308},
				{29.60798114772725, 106.4994386426911},
				{29.608084659626282, 106.49888183422395},
				{29.607872055576774, 106.49871448244332},
				{29.607097596199505, 106.49901438134185},
				{29.605106983780107, 106.49908902417768},
				{29.604970916380154, 106.5003189452669},
				{29.604964387841033, 106.50472646648787},
				{29.604807124943463, 106.50486248006679},
				{29.603360071265172, 106.50481242742421},
				{29.603452608664508, 106.50494769751398},
			},
		},
	}

	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			got := compose.DouglasPeucker(tt.input, 0.0001)
			if len(got) != len(tt.want) {
				t.Errorf("DouglasPeucker() = %v, want %v", got, tt.want)
			} else {
				for i, p := range got {
					if p.X != tt.want[i].X || p.Y != tt.want[i].Y {
						t.Errorf("DouglasPeucker() = %v, want %v", got, tt.want)
					}
				}
			}
		})
	}
}
